<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>STREETZ FARMZ — Authenticity</title>
  <meta name="theme-color" content="#0b0b0f"/>

  <style>
    :root{
      --bg:#07070a;
      --text:#f4f4ff;
      --muted:#b9b9d0;

      --orange:#ff8a00;
      --orange2:#ffb000;

      --good:#46ff9a;
      --bad:#ff3b5c;

      --shadow: 0 18px 60px rgba(0,0,0,.65);
      --border: 1px solid rgba(255,138,0,.35);
      --radius: 18px;

      /* JS setea el fondo general */
      --web-bg: none;
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:#07070a;
      overflow-x:hidden;
      position:relative;
    }

    /* ✅ Fondo general (depende de la calidad) */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      z-index:-2;

      background-image: var(--web-bg, none);
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;

      filter: saturate(1.05) contrast(1.05);
      opacity:.95;
      transform: translateZ(0);
    }

    /* ✅ Oscurecido neutro para legibilidad */
    body::after{
      content:"";
      position:fixed;
      inset:0;
      z-index:-1;

      background:
        radial-gradient(1100px 700px at 20% 10%, rgba(0,0,0,.18), transparent 60%),
        radial-gradient(900px 600px at 80% 30%, rgba(0,0,0,.22), transparent 65%),
        linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.60) 70%, rgba(0,0,0,.72));
    }

    .grain{
      pointer-events:none;
      position:fixed; inset:0;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.25'/%3E%3C/svg%3E");
      mix-blend-mode:overlay;
      opacity:.22;
      z-index:0;
    }

    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:12px 12px;
      position:relative;
      z-index:1;
    }

    .shell{
      width:min(880px, 100%);
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:14px;
    }

    @media (max-width: 880px){
      .shell{grid-template-columns:1fr}
    }

    .card{
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: var(--border);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }

    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(800px 320px at 50% 0%, rgba(255,255,255,.06), transparent 60%);
      filter: blur(14px);
      opacity:.35;
      z-index:0;
    }

    .card > *{position:relative; z-index:1}

    .header{
      padding:12px 14px 10px 14px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      background: linear-gradient(180deg, rgba(10,10,16,.88), rgba(10,10,16,.55));
    }

    .brand{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }

    .logo{
      line-height:1;
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:0;
      align-items:flex-start;
      text-align:left;
    }

    .logo img{
      display:none;
      width: min(300px, 72vw);
      height:auto;
      filter: drop-shadow(0 12px 26px rgba(0,0,0,.55));
      margin:0;
    }

    .brand-fallback{
      display:block;
      font-weight:950;
      letter-spacing:.06em;
      text-transform:uppercase;
      font-size:22px;
      line-height:1;
      color:#fff;
      text-shadow: 0 0 18px rgba(0,0,0,.35);
      text-align:left;
    }

    .logo .sub{
      margin:0;
      padding-top:2px;
      font-size:12px;
      color:var(--muted);
      letter-spacing:.18em;
      text-transform:uppercase;
      text-align:left;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:9px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.35);
      font-weight:700;
      font-size:12px;
      color: rgba(255,255,255,.92);
      white-space:nowrap;
      max-width: 100%;
    }

    .dot{
      width:10px;height:10px;border-radius:50%;
      background: rgba(255,255,255,.35);
      box-shadow: 0 0 16px rgba(255,255,255,.18);
      flex:0 0 auto;
    }

    .main{
      padding:12px 14px 14px 14px;
      background: linear-gradient(180deg, rgba(10,10,16,.45), rgba(10,10,16,.15));
    }

    /* ✅ RECUADRO (calidad) mostrando SOLO el lettering (sin texto ni pill) */
    .quality{
      --quality-bg: none;
      position:relative;
      overflow:hidden;

      display:flex;
      align-items:center;       /* centrado vertical */
      justify-content:center;   /* centrado horizontal */
      gap:0;
      padding:18px 12px;        /* un poco más alto */

      border-radius: 14px;
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.08);
      min-width:0;
    }

    .quality::before{
      content:"";
      position:absolute;
      inset:0;
      z-index:0;

      background-image: var(--quality-bg);
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;

      opacity:1;
      filter: saturate(1.05) contrast(1.05);
      transform: scale(1.02);
    }

    /* overlay neutro muy suave */
    .quality::after{
      content:"";
      position:absolute;
      inset:0;
      z-index:0;
      background: linear-gradient(180deg, rgba(0,0,0,.04), rgba(0,0,0,.20));
      opacity:1;
    }

    .quality > *{ position:relative; z-index:1; }

    .qwrap{
      min-width:0;
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
    }

    .q-lettering{
      display:block;
      width: min(420px, 78vw); /* más grande */
      height:auto;
      max-width:100%;
      margin:0;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.55));
      align-self:center;
    }

    /* ✅ QUITAMOS la info del recuadro rojo */
    #qualityDesc{ display:none !important; }
    #pill{ display:none !important; }

    .status{
      margin-top:10px;
      padding:12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.33);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      min-width:0;
    }

    .status .big{
      font-size:32px;
      font-weight:950;
      letter-spacing:.5px;
      text-transform:uppercase;
      line-height:1;
    }

    .status .hint{
      text-align:right;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
      max-width: 260px;
    }

    .meta{
      margin-top:10px;
      padding:12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.26);
      color: rgba(255,255,255,.88);
      line-height:1.55;
      font-size:14px;
      overflow-x:auto;
    }

    .meta code{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      padding:2px 7px;
      border-radius:8px;
      color:#fff;
      font-weight:800;
      white-space:nowrap;
      word-break:keep-all;
      display:inline-block;
      max-width:100%;
    }

    .side{
      padding:18px;
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .sidebox{
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.28);
      padding:14px;
    }

    .sidebox h3{
      margin:0 0 8px 0;
      font-size:14px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color: rgba(255,255,255,.90);
    }

    .sidebox p{
      margin:0;
      color: var(--muted);
      font-size:13px;
      line-height:1.55;
    }

    .footer{
      margin-top:auto;
      color: rgba(255,255,255,.35);
      font-size:12px;
      text-align:center;
      padding-top:6px;
    }

    .good{ color: var(--good); text-shadow: 0 0 16px rgba(70,255,154,.15); }
    .bad { color: var(--bad);  text-shadow: 0 0 16px rgba(255,59,92,.12); }
    .warn{ color: var(--orange2); text-shadow: 0 0 16px rgba(255,176,0,.12); }

    .accent-ring{
      position:absolute; inset:-1px;
      border-radius: var(--radius);
      pointer-events:none;
      background: conic-gradient(from 180deg, rgba(255,138,0,.0), rgba(255,138,0,.18), rgba(33,184,255,.12), rgba(255,138,0,.0));
      mask: linear-gradient(#000, #000) content-box, linear-gradient(#000, #000);
      -webkit-mask: linear-gradient(#000, #000) content-box, linear-gradient(#000, #000);
      padding:1px;
      opacity:.25;
    }

    @media (max-width: 520px){
      .brand{
        flex-direction:column;
        align-items:flex-start;
        gap:8px;
      }
      .badge{
        align-self:flex-start;
        margin-top:2px;
      }
      .logo img{
        width: min(290px, 80vw);
      }
    }
  </style>
</head>

<body>
  <div class="grain"></div>

  <div class="wrap">
    <div class="shell">

      <!-- MAIN CARD -->
      <div class="card">
        <div class="accent-ring"></div>

        <div class="header">
          <div class="brand">
            <div class="logo">
              <img id="brandTitleImg" alt="STREETZ FARMZ">
              <div id="brandFallback" class="brand-fallback">STREETZ FARMZ</div>
              <div class="sub">AUTHENTICITY CHECK</div>
            </div>

            <div class="badge">
              <span class="dot" id="dot"></span>
              <span id="badgeText">Scanning…</span>
            </div>
          </div>
        </div>

        <div class="main">
          <div class="quality" id="qualityBox">
            <div class="qwrap">
              <img id="qualityLetteringImg" class="q-lettering" alt="Quality lettering">
              <div id="qualityDesc">Verification in progress…</div>
            </div>
            <div class="pill" id="pill">QUALITY</div>
          </div>

          <div class="status">
            <div class="big warn" id="statusText">CHECKING</div>
            <div class="hint" id="statusHint">
              Keep this page open.<br/>We are verifying the QR signature.
            </div>
          </div>

          <div class="meta" id="meta">
            Loading details…
          </div>
        </div>
      </div>

      <!-- SIDE PANEL -->
      <div class="card">
        <div class="accent-ring"></div>
        <div class="side">
          <div class="sidebox">
            <h3>How it works</h3>
            <p>
              Each unit has a unique QR code containing a cryptographic signature.
              If the signature is valid, the product is marked as <b>AUTHENTIC</b>.
            </p>
          </div>

          <div class="sidebox">
            <h3>Warning</h3>
            <p>
              If you see <b>FAKE</b> or the page looks modified, do not trust the product.
              Take a screenshot and contact the seller.
            </p>
          </div>

          <div class="sidebox">
            <h3>Tip</h3>
            <p>
              If your phone opens a different domain than <b>streetz-farmz.github.io</b>,
              the QR may be cloned.
            </p>
          </div>

          <div class="footer">© STREETZ FARMZ — Verification Page</div>
        </div>
      </div>

    </div>
  </div>

<script>
const PUBLIC_KEY_PEM = `-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAugMJ76e+l3g7DepjOdzE
S0FKgnaWM7jlSsUfCjqNUz6qHxmurZfOiPreHywxy5jodZyR96ZZf631PqK6UUai
zMG2xMf8YpB4Qljo5vmrI5Pw4pJpIxmevAe9/YhoJImQI8hJcqmWw9mgiYGs4Yk2
uUjKgPud5NUVE5rv17a3OHbv+oOLTH120VsTT+VPs2jcFTXXiXDSiWmza6IXGkhk
38/yGrGh4FKrOBJ57Dk9O2RwnR98wu5zF7hhKOQHbzOEnZFq0kk00gn/GHGrfJwY
rfBeLL6n3Bdr3UKwmBL5S7xE/W33A9JW5gt3+no2waQFsTwDahorjLIzJ4nHsSeV
8wIDAQAB
-----END PUBLIC KEY-----`;

// Cambia el número cuando subas nuevos assets para forzar recarga
const CACHE_BUST = "v=15";

// assets en assets/qualities
const BRAND_LOGO_PATH = "assets/qualities/STREETZFARM_LETTERING.png";

const QUALITY_BG = {
  frozen:  "assets/qualities/SF_FROZEN_FONDO.JPG",
  static:  "assets/qualities/SF_STATIC_FONDO.JPG",
  ffstatic:"assets/qualities/SF_FFSTATIC_FONDO.JPG",
  drysift: "assets/qualities/SF_DRY_FONDO.JPG"
};
const DEFAULT_BG = "assets/qualities/SF_WEB_FONDO.JPG";

function q(name){ return new URL(location.href).searchParams.get(name) || ""; }

function b64urlToBytes(b64url){
  const b64 = b64url.replace(/-/g,"+").replace(/_/g,"/") + "===".slice((b64url.length + 3) % 4);
  const bin = atob(b64);
  const bytes = new Uint8Array(bin.length);
  for(let i=0;i<bin.length;i++) bytes[i]=bin.charCodeAt(i);
  return bytes;
}

function pemToArrayBuffer(pem){
  const b64 = pem.replace(/-----.*-----/g,"").replace(/\s+/g,"");
  const bin = atob(b64);
  const bytes = new Uint8Array(bin.length);
  for(let i=0;i<bin.length;i++) bytes[i]=bin.charCodeAt(i);
  return bytes.buffer;
}

function setBadge(text, color){
  document.getElementById("badgeText").textContent = text;
  const dot = document.getElementById("dot");
  dot.style.background = color;
  dot.style.boxShadow = `0 0 16px ${color}55`;
}

function normQuality(s){
  return (s || "").toLowerCase().replace(/[^a-z0-9]+/g, " ").trim();
}

function withCacheBust(url){
  if(!url) return url;
  return url.includes("?") ? `${url}&${CACHE_BUST}` : `${url}?${CACHE_BUST}`;
}

function setupBrandLogo(){
  const brandImg = document.getElementById("brandTitleImg");
  const fallback = document.getElementById("brandFallback");

  brandImg.src = withCacheBust(BRAND_LOGO_PATH);

  brandImg.onload = () => {
    fallback.style.display = "none";
    brandImg.style.display = "block";
  };

  brandImg.onerror = () => {
    brandImg.style.display = "none";
    fallback.style.display = "block";
  };
}

function qualityLetteringPath(quality){
  const key = normQuality(quality);

  const MAP = {
    "drysift": "assets/qualities/LETTERING_STREETZFARMZ_DRYSIFT.PNG",
    "premium drysift": "assets/qualities/LETTERING_STREETZFARMZ_PREMIUM_DRYSIFT.PNG",

    "frozen": "assets/qualities/LETTERING_STREETZFARMZ_FROZEN.PNG",
    "premium frozen": "assets/qualities/LETTERING_STREETZFARMZ_PREMIUM_FROZEN.PNG",

    "static": "assets/qualities/LETTERING_STREETZFARMZ_STATIC.PNG",
    "premium static": "assets/qualities/LETTERING_STREETZFARMZ_PREMIUM_STATIC_.PNG",

    "fresh frozen static": "assets/qualities/LETTERING_STREETZFARMZ_FFSTATIC.PNG",
    "premium fresh frozen static": "assets/qualities/LETTERING_STREETZFARMZ_PREMIUM_FFSTATIC.PNG"
  };

  return MAP[key] || BRAND_LOGO_PATH;
}

function backgroundPathForQuality(quality){
  const qq = (quality || "").toLowerCase();

  if(qq.includes("fresh") && qq.includes("static")) return QUALITY_BG.ffstatic;
  if(qq.includes("frozen")) return QUALITY_BG.frozen;
  if(qq.includes("drysift")) return QUALITY_BG.drysift;
  if(qq.includes("static")) return QUALITY_BG.static;

  return DEFAULT_BG;
}

function qualityTheme(quality){
  const qq = (quality || "").toLowerCase();

  if(qq.includes("premium") && qq.includes("frozen")) return { color:"#21b8ff" };
  if(qq.includes("frozen")) return { color:"#21b8ff" };

  if(qq.includes("premium") && qq.includes("drysift")) return { color:"#d6d6e8" };
  if(qq.includes("drysift")) return { color:"#d6d6e8" };

  if(qq.includes("premium") && qq.includes("fresh") && qq.includes("static")) return { color:"#00d1ff" };
  if(qq.includes("fresh") && qq.includes("static")) return { color:"#00d1ff" };

  if(qq.includes("premium") && qq.includes("static")) return { color:"#0066ff" };
  if(qq.includes("static")) return { color:"#0066ff" };

  return { color:"#ff8a00" };
}

async function run(){
  setupBrandLogo();

  const code = q("c").trim();
  const brand = q("m").trim();
  const quality = q("p").trim();
  const batch = q("l").trim();
  const sig = q("s").trim();

  const statusText = document.getElementById("statusText");
  const statusHint = document.getElementById("statusHint");
  const meta = document.getElementById("meta");

  // ✅ Fondo general y del recuadro según calidad
  const bg = backgroundPathForQuality(quality);
  document.documentElement.style.setProperty("--web-bg", `url("${withCacheBust(bg)}")`);

  const qualityBox = document.getElementById("qualityBox");
  if (qualityBox){
    qualityBox.style.setProperty("--quality-bg", `url("${withCacheBust(bg)}")`);
  }

  // ✅ Lettering (esto es lo ÚNICO visible dentro del recuadro)
  const qImg = document.getElementById("qualityLetteringImg");
  if (qImg){
    qImg.src = withCacheBust(qualityLetteringPath(quality));
    qImg.onerror = () => { qImg.src = withCacheBust(BRAND_LOGO_PATH); };
  }

  const th = qualityTheme(quality);
  setBadge("Checking signature…", th.color);

  if(!code || !sig){
    statusText.textContent = "FAKE";
    statusText.className = "big bad";
    statusHint.innerHTML = "Missing parameters in the QR link.";
    setBadge("Invalid QR link", "#ff3b5c");
    meta.innerHTML = `This QR does not contain the required verification data.`;
    return;
  }

  const msg = `${code}|${brand}|${quality}|${batch}`;

  try{
    const key = await crypto.subtle.importKey(
      "spki",
      pemToArrayBuffer(PUBLIC_KEY_PEM),
      { name:"RSA-PSS", hash:"SHA-256" },
      false,
      ["verify"]
    );

    const ok = await crypto.subtle.verify(
      { name:"RSA-PSS", saltLength:32 },
      key,
      b64urlToBytes(sig),
      new TextEncoder().encode(msg)
    );

    if(ok){
      statusText.textContent = "AUTHENTIC";
      statusText.className = "big good";
      statusHint.innerHTML = "Signature verified successfully.";
      setBadge("Authentic", "#46ff9a");

      meta.innerHTML =
        `Code: <code>${code}</code><br>` +
        `Brand: <b>${brand || "—"}</b><br>` +
        `Quality: <b>${quality || "—"}</b><br>` +
        `Batch: <b>${batch || "—"}</b>`;
    }else{
      statusText.textContent = "FAKE";
      statusText.className = "big bad";
      statusHint.innerHTML = "Signature mismatch.";
      setBadge("Fake", "#ff3b5c");

      meta.innerHTML =
        `This QR signature is not valid.<br>` +
        `Do not trust this product.`;
    }

  }catch(e){
    statusText.textContent = "ERROR";
    statusText.className = "big warn";
    statusHint.innerHTML = "Verification failed.";
    setBadge("Error", "#ffb000");

    meta.innerHTML =
      `Your browser could not verify the signature.<br>` +
      `Most common reason: the public key was not pasted correctly into verify.html.`;
  }
}

run();
</script>
</body>
</html>
