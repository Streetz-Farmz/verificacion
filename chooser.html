<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>STREETZ FARMZ — Choosing code…</title>
  <meta name="theme-color" content="#0b0b0f"/>
  <style>
    body{
      margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:#07070a; color:#fff;
      padding:18px; text-align:center;
    }
    .box{
      max-width:520px; width:100%;
      border:1px solid rgba(255,138,0,.35);
      border-radius:16px;
      background:rgba(255,255,255,.04);
      padding:18px;
    }
    .muted{opacity:.75; font-size:14px; line-height:1.4}
    code{background:rgba(255,255,255,.08); padding:2px 6px; border-radius:8px}
  </style>
</head>
<body>
  <div class="box">
    <h2>STREETZ FARMZ</h2>
    <div class="muted" id="msg">Choosing a code for this quality…</div>
  </div>

<script>
function q(name){ return new URL(location.href).searchParams.get(name) || ""; }

function slugifyQuality(s){
  return (s || "")
    .toLowerCase()
    .trim()
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/^-|-$/g, "");
}

async function run(){
  const quality = q("p").trim();
  if(!quality){
    document.getElementById("msg").innerHTML = "Missing <code>p</code> parameter.";
    return;
  }

  const slug = slugifyQuality(quality);
  const poolUrl = `assets/pools/${slug}.json?v=1`;

  document.getElementById("msg").innerHTML =
    `Loading pool: <code>${poolUrl}</code><br><span class="muted">Quality: ${quality}</span>`;

  try{
    const res = await fetch(poolUrl, { cache: "no-store" });
    if(!res.ok) throw new Error("Pool not found (HTTP " + res.status + ")");

    const pool = await res.json();
    if(!Array.isArray(pool) || pool.length === 0) throw new Error("Empty pool file");

    const pick = pool[Math.floor(Math.random() * pool.length)];

    const u = new URL("verify.html", location.href);
    u.searchParams.set("c", pick.c);
    u.searchParams.set("s", pick.s);
    u.searchParams.set("m", pick.m);
    u.searchParams.set("p", pick.p);
    u.searchParams.set("l", pick.l);

    location.replace(u.toString());
  }catch(e){
    document.getElementById("msg").innerHTML =
      `Error loading pool.<br><span class="muted">${String(e.message || e)}</span>`;
  }
}
run();
</script>
</body>
</html>
